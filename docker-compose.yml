services:
    nextcloud:
        environment:
             NEXTCLOUD_FQDN: lt.seeker-odysseas.net
             MARIADB_ROOT_PASSWORD: "$MARIADB_ROOT_PASSWORD"
        ports:
            - 21543:443
            - 21180:80
        depends_on:
            - database
        image: nextcloud:latest
        volumes:
            - ${HOST_BASE}/nextcloud/data:${CONTAINER_BASE}/var/www/html/data
            - ${HOST_BASE}/nextcloud/settings/html:${CONTAINER_BASE}/var/www/html
            - ${HOST_BASE}/nextcloud/logs/nextcloud:${CONTAINER_BASE}/var/log/apache2
            - ${HOST_BASE}/nextcloud/settings/etc/apache2:${CONTAINER_BASE}/etc/apache2
            - ${HOST_BASE}/nextcloud/settings/certificates/nextcloud/:${CONTAINER_BASE}/etc/ssl/certs/nextcloud/
        tty: true
        stdin_open: true
        networks:
            - nextcloud
        restart: unless-stopped
    database:
        environment:
            MARIADB_ROOT_PASSWORD: "$MARIADB_ROOT_PASSWORD"
        ports:
            - 3406:3306
        expose:
            - 3306
        build:
            context: ./mariadb-docker/10.10/
            dockerfile: ./Dockerfile
        image: "database:latest"
        volumes:
            - ${HOST_BASE}/nextcloud/settings/db:${CONTAINER_BASE}/var/lib/mysql
            - ${HOST_BASE}/nextcloud/logs/database:${CONTAINER_BASE}/var/log/mysql
            - ${HOST_BASE}/nextcloud/settings/etc/mysql:${CONTAINER_BASE}/etc/mysql
        tty: true
        stdin_open: true
        networks:
            - nextcloud
        restart: unless-stopped
networks:
    nextcloud:
        ipam:
            config:
                - subnet: 172.20.7.0/24
